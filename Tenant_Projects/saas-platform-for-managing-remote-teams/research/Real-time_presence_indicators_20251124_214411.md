# Research Report: * Real-time presence indicators.
**Date**: 2025-11-24T21:44:11.397968
**Task**: task_0486_researcher - Research: Real-Time Presence Protocols
**Depth**: deep
**Confidence Score**: 45/100
**Cached**: No

---

## Summary

### Key Findings

- "https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API",
- "https://python-socketio.readthedocs.io/en/latest/",
- "https://redis.io/docs/data-types/hashes/",
- "https://developer.mozilla.org/en-US/docs/Web/API/EventSource"
- "description": "Socket.io Server for Presence Tracking (using python-socketio)",
- "code": "import socketio\nimport eventlet\nimport json\n\nsio = socketio.Server(cors_allowed_origins='*')\napp = socketio.WSGIApp(sio)\n\n# In-memory store for presence (for simplicity, use Redis in production)\nuser_presence = {}\nuser_socket_map = {}\n\n@sio.event\ndef connect(sid, environ, auth):\n    user_id = auth.get('user_id') if auth else None\n    if not user_id:\n        print(f\"Unauthorized connection: {sid}\")\n        raise ConnectionRefusedError('Authentication required')\n\n    user_socket_map[sid] = user_id\n    user_presence[user_id] = {'status': 'online', 'last_seen': eventlet.hubs.get_hub().clock(), 'sid': sid}\n    print(f\"User {user_id} connected with SID {sid}\")\n    sio.emit('presence_update', {'user_id': user_id, 'status': 'online'}, skip_sid=sid)\n    sio.emit('current_presence', user_presence, room=sid)\n\n@sio.event\ndef disconnect(sid):\n    user_id = user_socket_map.pop(sid, None)\n    if user_id:\n        # Set status to 'offline' or 'idle' after a grace period\n        # For this example, we'll immediately set to offline\n        if user_id in user_presence and user_presence[user_id]['sid'] == sid:\n            user_presence[user_id]['status'] = 'offline'\n            user_presence[user_id]['last_seen'] = eventlet.hubs.get_hub().clock()\n            print(f\"User {user_id} disconnected from SID {sid}\")\n            sio.emit('presence_update', {'user_id': user_id, 'status': 'offline'}, skip_sid=sid)\n        else:\n            print(f\"SID {sid} disconnected, but user_id {user_id} not found or mismatched.\")\n    else:\n        print(f\"Unknown SID {sid} disconnected.\")\n\n@sio.event\ndef heartbeat(sid, data):\n    user_id = user_socket_map.get(sid)\n    if user_id and user_id in user_presence:\n        user_presence[user_id]['last_seen'] = eventlet.hubs.get_hub().clock()\n        # Optionally update status to 'active' if it was 'idle'\n        if user_presence[user_id]['status'] == 'idle':\n            user_presence[user_id]['status'] = 'online'\n            sio.emit('presence_update', {'user_id': user_id, 'status': 'online'}, skip_sid=sid)\n\n@sio.event\ndef update_status(sid, data):\n    user_id = user_socket_map.get(sid)\n    if user_id and user_id in user_presence:\n        new_status = data.get('status')\n        if new_status in ['online', 'idle', 'away', 'watching_game']:\n            user_presence[user_id]['status'] = new_status\n            if new_status == 'watching_game':\n                user_presence[user_id]['game_id'] = data.get('game_id')\n            else:\n                user_presence[user_id].pop('game_id', None)\n            user_presence[user_id]['last_seen'] = eventlet.hubs.get_hub().clock()\n            print(f\"User {user_id} updated status to {new_status}\")\n            sio.emit('presence_update', {'user_id': user_id, 'status': new_status, 'game_id': data.get('game_id')}, skip_sid=sid)\n\n# Example of integrating with NBA data (hypothetical)\ndef get_nba_game_data(game_id):\n    # In a real application, this would fetch from an NBA API or database\n    # For demonstration, return dummy data\n    if game_id == 'NBA_GAME_123':\n        return {'id': 'NBA_GAME_123', 'team1': 'Lakers', 'team2': 'Celtics', 'score': '98-95'}\n    return None\n\n@sio.event\ndef request_game_info(sid, data):\n    game_id = data.get('game_id')\n    game_info = get_nba_game_data(game_id)\n    if game_info:\n        sio.emit('game_info', game_info, room=sid)\n    else:\n        sio.emit('game_info_error', {'message': 'Game not found'}, room=sid)\n\nif __name__ == '__main__':\n    print(\"Starting Socket.io server on port 5000...\")\n    eventlet.wsgi.server(eventlet.listen(('', 5000)), app)\n"
- "description": "Client-side Socket.io for Presence and NBA Game Status",
- "code": "import { io } from \"socket.io-client\";\n\nconst userId = `user_${Math.floor(Math.random() * 1000)}`; // Simulate a unique user ID\nconst socket = io(\"http://localhost:5000\", {\n  auth: { user_id: userId },\n  transports: ['websocket', 'polling']\n});\n\nlet currentPresence = {};\n\nsocket.on(\"connect\", () => {\n  console.log(`Connected with SID: ${socket.id}, User ID: ${userId}`);\n  // Send a heartbeat every 30 seconds\n  setInterval(() => {\n    socket.emit('heartbeat');\n  }, 30000);\n});\n\nsocket.on(\"disconnect\", () => {\n  console.log(`Disconnected: ${socket.id}`);\n});\n\nsocket.on(\"connect_error\", (err) => {\n  console.error(`Connection Error: ${err.message}`);\n});\n\nsocket.on(\"presence_update\", (data) => {\n  console.log(\"Presence Update:\", data);\n  currentPresence[data.user_id] = data;\n  updateUI();\n});\n\nsocket.on(\"current_presence\", (data) => {\n  console.log(\"Initial Presence State:\", data);\n  currentPresence = data;\n  updateUI();\n});\n\nsocket.on(\"game_info\", (data) => {\n  console.log(\"Received Game Info:\", data);\n  // Update UI with game details\n  document.getElementById('game-info').innerText = `Game: ${data.team1} vs ${data.team2}, Score: ${data.score}`;\n});\n\nsocket.on(\"game_info_error\", (data) => {\n  console.error(\"Game Info Error:\", data.message);\n  document.getElementById('game-info').innerText = `Error: ${data.message}`;\n});\n\nfunction updateUI() {\n  const presenceList = document.getElementById('presence-list');\n  if (!presenceList) return;\n  presenceList.innerHTML = '';\n  for (const id in currentPresence) {\n    const user = currentPresence[id];\n    const li = document.createElement('li');\n    let statusText = `${user.status}`; \n    if (user.status === 'watching_game' && user.game_id) {\n        statusText += ` (Game: ${user.game_id})`;\n    }\n    li.textContent = `User ${id}: ${statusText}`;\n    presenceList.appendChild(li);\n  }\n}\n\n// Example functions to trigger status updates\nwindow.goOnline = () => {\n  socket.emit('update_status', { status: 'online' });\n};\n\nwindow.goIdle = () => {\n  socket.emit('update_status', { status: 'idle' });\n};\n\nwindow.watchGame = (gameId) => {\n  socket.emit('update_status', { status: 'watching_game', game_id: gameId });\n  socket.emit('request_game_info', { game_id: gameId });\n};\n\n// Basic HTML structure for testing (not part of the JS code block itself)\n/*\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Presence Demo</title>\n    <script src=\"https://cdn.socket.io/4.7.5/socket.io.min.js\"></script>\n</head>\n<body>\n    <h1>Real-time Presence</h1>\n    <p>Your User ID: <span id=\"my-user-id\"></span></p>\n    <button onclick=\"goOnline()\">Go Online</button>\n    <button onclick=\"goIdle()\">Go Idle</button>\n    <button onclick=\"watchGame('NBA_GAME_123')\">Watch NBA Game 123</button>\n    <button onclick

### Official Documentation

- https://redis.io/docs/data-types/hashes/",
- http://localhost:5000\",
- https://python-socketio.readthedocs.io/en/latest/",
- https://cdn.socket.io/4.7.5/socket.io.min.js\"></script>\n</head>\n<body>\n
- https://socket.io/docs/v4/",
- https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API",
- https://developer.mozilla.org/en-US/docs/Web/API/EventSource"

### Search Results

---

*Research conducted by ResearcherAgent (researcher_main)*
*Sources consulted: llm_research_text, llm_research*