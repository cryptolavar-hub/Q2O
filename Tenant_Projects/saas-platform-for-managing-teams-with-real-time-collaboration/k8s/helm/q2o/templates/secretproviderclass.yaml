# Key Vault CSI SecretProviderClass
# Generated by InfrastructureAgent
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: q2o-secrets
  namespace: {{ .Values.namespace | default "default" }}
spec:
  provider: azure
  secretObjects:
  - secretName: q2o-secrets
    type: Opaque
    data:
    - objectName: DATABASE_URL
      key: DATABASE_URL
    - objectName: NEXTAUTH_SECRET
      key: NEXTAUTH_SECRET
    - objectName: QBO_CLIENT_ID
      key: QBO_CLIENT_ID
    - objectName: QBO_CLIENT_SECRET
      key: QBO_CLIENT_SECRET
    - objectName: STRIPE_SECRET
      key: STRIPE_SECRET
    - objectName: STRIPE_WEBHOOK_SECRET
      key: STRIPE_WEBHOOK_SECRET
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: ""
    keyvaultName: {{ .Values.secrets.keyVault.vaultName | quote }}
    objects: |
      array:
      {{- range .Values.secrets.keyVault.objects }}
      - |
        objectName: {{ .objectName }}
        objectType: {{ .objectType }}
      {{- end }}
    tenantId: ""
