# VCS Integration Guide - Priority 7

## Overview

The VCS Integration feature provides automatic Git operations including:
- **Auto-commit** after task completion
- **Feature branch creation** for projects
- **Pull Request creation** via GitHub API

## Setup

### 1. Enable VCS Integration

Set environment variable:
```bash
# Windows PowerShell
$env:VCS_ENABLED="true"

# Linux/Mac
export VCS_ENABLED=true
```

Or in `.env` file:
```
VCS_ENABLED=true
```

### 2. Configure GitHub (for PR creation)

Set GitHub credentials:
```bash
# Windows PowerShell
$env:GITHUB_TOKEN="ghp_your_token_here"
$env:GITHUB_REPO="owner/repository-name"

# Linux/Mac
export GITHUB_TOKEN="ghp_your_token_here"
export GITHUB_REPO="owner/repository-name"
```

### 3. Ensure Git is Available

```bash
git --version
```

If not installed, install Git from: https://git-scm.com/

## Features

### Auto-Commit

- **When**: After each task completion
- **What**: Commits only files created by that specific task
- **Commit Message**: Auto-generated from task title and files created
- **Format**: `feat: {task_title}\n\nTask: {task_id}\nFiles created: {file_list}`

### Feature Branch Creation

- **When**: After entire project completion
- **Branch Name**: `feature/{project-description}-{timestamp}`
- **Base Branch**: `main` (configurable)

### Pull Request Creation

- **When**: After feature branch is pushed
- **Title**: `feat: {project_description}`
- **Body**: Includes:
  - Project description
  - List of objectives
  - List of generated files
  - Generated by notice

## Usage Examples

### Basic Usage (Auto-commit only)

```bash
# Just set VCS_ENABLED
$env:VCS_ENABLED="true"
python main.py --project "My Project" --objective "Feature 1"
```

This will:
1. Auto-commit files after each task
2. Work even if not a Git repo (will initialize one)

### Full Integration (Auto-commit + PR)

```bash
# Set all required variables
$env:VCS_ENABLED="true"
$env:GITHUB_TOKEN="ghp_your_token"
$env:GITHUB_REPO="cryptolavar-hub/Q2O"

python main.py --project "OAuth Integration" --objective "QuickBooks OAuth"
```

This will:
1. Auto-commit files after each task
2. Create feature branch after project completion
3. Push branch to remote
4. Create PR automatically

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `VCS_ENABLED` | `false` | Enable/disable VCS integration |
| `GITHUB_TOKEN` | - | GitHub Personal Access Token |
| `GITHUB_REPO` | - | Repository (format: `owner/repo`) |

### GitManager Options

```python
from utils.git_manager import get_git_manager

# With auto-commit enabled
git_manager = get_git_manager(workspace_path=".", auto_commit=True)

# With auto-commit disabled
git_manager = get_git_manager(workspace_path=".", auto_commit=False)
```

## File Tracking

The system tracks files created by each agent type:
- `integration_files` - From IntegrationAgent
- `frontend_files` - From FrontendAgent
- `infrastructure_files` - From InfrastructureAgent
- `workflow_files` - From WorkflowAgent
- `node_files` - From NodeAgent
- `files_created` - Generic (from CoderAgent)

## Commit Messages

Auto-generated commit messages follow this format:
```
feat: {task_title}

Task: {task_id}
Files created: {file1}, {file2}, ...
Generated by Multi-Agent System
```

## PR Format

Pull requests include:
- **Title**: `feat: {project_description}`
- **Body**:
  - Project description
  - Objectives list
  - Generated files list
  - Generated by notice with timestamp

## Troubleshooting

### "Git is not available"
- Install Git from https://git-scm.com/
- Ensure `git` is in your PATH

### "Not a Git repository"
- The system will auto-initialize if `VCS_ENABLED=true`
- Or manually: `git init`

### "GitHub token or repo not configured"
- Set `GITHUB_TOKEN` and `GITHUB_REPO` environment variables
- PR creation will be skipped, but commits will still work

### "Push failed"
- Ensure remote is configured: `git remote add origin <url>`
- Check branch permissions
- Verify GitHub token has push access

### "PR creation failed"
- Verify GitHub token has `repo` scope
- Check repository name format: `owner/repo`
- Ensure branch was pushed successfully

## Security Notes

1. **Never commit tokens or secrets** - The system respects `.gitignore`
2. **Use environment variables** - Don't hardcode tokens
3. **Token scope** - GitHub token needs `repo` scope for PR creation
4. **Review PRs** - Always review auto-generated PRs before merging

## Example Output

```
2025-11-02 13:30:00 - __main__ - INFO - VCS integration enabled
2025-11-02 13:30:15 - utils.git_manager - INFO - Created commit: feat: Integration: OAuth authentication
2025-11-02 13:30:20 - utils.git_manager - INFO - Created feature branch: feature-oauth-integration-1698921000
2025-11-02 13:30:25 - utils.git_manager - INFO - Pushed branch: feature-oauth-integration-1698921000
2025-11-02 13:30:30 - utils.vcs_integration - INFO - Created PR #123: https://github.com/owner/repo/pull/123
```

