# Code Generation Name Pattern Guide
**Date**: November 24, 2025  
**Status**: ✅ Pattern Established

---

## Core Principle

**Agents must:**
1. ✅ **Receive FULL descriptions/objectives** (for complete understanding)
2. ✅ **Use FULL descriptions in code** (for docstrings, comments, context)
3. ✅ **Generate CONCISE names for identifiers** (class names, function names, variable names)

---

## Pattern Implementation

### ✅ Correct Pattern (Current Implementation)

```python
def _generate_api_code(self, objective: str, task: Task) -> str:
    """
    Generate code using FULL objective for context, but CONCISE names for identifiers.
    
    Args:
        objective: FULL objective/description (e.g., "Do an initial check to the QuickBooks API using the keys provided...")
        task: Task object with full description
    """
    # Step 1: Generate CONCISE name for identifiers
    concise_name = generate_concise_name(objective, max_length=40)  # "QuickBooks API Check"
    sanitized = sanitize_objective(concise_name)
    module_name = sanitized['filename']  # "quickbooks_api_check"
    class_name = sanitized['class_name']  # "QuickBooksApiCheck"
    
    # Step 2: Use FULL objective for context/comments/docstrings
    return f'''
"""
FastAPI endpoints for {objective}  ← FULL objective in docstring
Generated by CoderAgent
"""

class {class_name}:  ← CONCISE class name
    """
    API client for {objective}  ← FULL objective in docstring
    """
    
    async def get_{module_name}(self):  ← CONCISE function name
        """
        GET endpoint for {objective}  ← FULL objective in docstring
        """
        logger.info(f"Processing {objective}")  ← FULL objective in logs
        ...
    '''
```

### ❌ Wrong Pattern (What NOT to do)

```python
# ❌ WRONG: Using full objective for identifiers
def _generate_api_code(self, objective: str, task: Task) -> str:
    sanitized = sanitize_objective(objective)  # ❌ Using full objective
    module_name = sanitized['filename']  # ❌ Very long filename
    class_name = sanitized['class_name']  # ❌ Very long class name
    
    return f'''
class {class_name}:  # ❌ Class name too long!
    def get_{module_name}(self):  # ❌ Function name too long!
        ...
    '''
```

---

## Current Implementation Status

### ✅ Already Correct

**1. API Code Generation (`_generate_api_code`):**
- ✅ Uses concise names: `module_name`, `class_name`
- ✅ Uses full objective: In docstrings, comments, logs
- ✅ Function names: `get_{module_name}`, `create_{module_name}` (concise)

**2. Model Code Generation (`_generate_model_code`):**
- ✅ Uses concise names: `class_name`, `table_name`
- ✅ Uses full objective: In docstrings, comments

**3. Service Code Generation (`_generate_service_code`):**
- ✅ Uses concise names: `class_name`, `method_name`
- ✅ Uses full objective: In docstrings, comments, logs

**4. Component Code Generation (`_generate_component_code`):**
- ✅ Uses concise names: `class_name`
- ✅ Uses full objective: In docstrings, comments

**5. Generic Code Generation (`_generate_generic_code`):**
- ✅ Uses concise names: `module_name`, `class_name`
- ✅ Uses full objective: In docstrings, comments

---

## Code Generation Flow

### Step-by-Step Process

```python
# 1. Agent receives task with FULL description
task = Task(
    title="Backend: QuickBooks API Check",  # CONCISE title
    description="Do an initial check to the QuickBooks API using the keys provided...",  # FULL description
    metadata={"objective": "Do an initial check to the QuickBooks API..."}  # FULL objective
)

# 2. Agent extracts FULL information
description = task.description  # FULL description
objective = metadata.get("objective")  # FULL objective

# 3. Agent generates CONCISE names for identifiers
concise_name = generate_concise_name(objective, max_length=40)  # "QuickBooks API Check"
sanitized = sanitize_objective(concise_name)
module_name = sanitized['filename']  # "quickbooks_api_check"
class_name = sanitized['class_name']  # "QuickBooksApiCheck"
function_name = sanitized['function_name']  # "quickbooks_api_check"

# 4. Agent generates code using BOTH:
code = f'''
"""
Module for {objective}  ← FULL objective (for documentation)
"""

class {class_name}:  ← CONCISE class name (for identifier)
    """
    Class for handling {objective}  ← FULL objective (for documentation)
    """
    
    def {function_name}(self):  ← CONCISE function name (for identifier)
        """
        Process {objective}  ← FULL objective (for documentation)
        """
        logger.info(f"Processing {objective}")  ← FULL objective (for logs)
        ...
'''
```

---

## Example: Complete Code Generation

### Input:
```python
objective = "Do an initial check to the QuickBooks API using the keys provided, the key and its required parameters must have each an input field on the UI for the client to enter, before the GET requests for the checks to QuickBooks DB"
```

### Generated Code:
```python
"""
FastAPI endpoints for Do an initial check to the QuickBooks API using the keys provided, 
the key and its required parameters must have each an input field on the UI for the client 
to enter, before the GET requests for the checks to QuickBooks DB
Generated by CoderAgent
"""

from fastapi import APIRouter, HTTPException, Depends, status
from typing import Dict, Any, Optional

router = APIRouter(prefix="/api/quickbooks_api_check", tags=["quickbooks_api_check"])

class QuickBooksApiCheckRequest(BaseModel):
    """Request model for Do an initial check to the QuickBooks API using the keys provided..."""
    api_key: str
    company_id: str

class QuickBooksApiCheckResponse(BaseModel):
    """Response model for Do an initial check to the QuickBooks API using the keys provided..."""
    status: str
    data: Optional[Dict[str, Any]]

@router.get("/", response_model=QuickBooksApiCheckResponse)
async def get_quickbooks_api_check(  # ← CONCISE function name
    api_key: str,
    company_id: str
) -> QuickBooksApiCheckResponse:
    """
    GET endpoint for Do an initial check to the QuickBooks API using the keys provided,
    the key and its required parameters must have each an input field on the UI for the 
    client to enter, before the GET requests for the checks to QuickBooks DB
    """
    logger.info(f"Processing Do an initial check to the QuickBooks API using the keys provided...")
    # Implementation uses FULL objective context
    ...
```

**Key Points:**
- ✅ **Class name**: `QuickBooksApiCheckRequest` (CONCISE - 25 chars)
- ✅ **Function name**: `get_quickbooks_api_check` (CONCISE - 25 chars)
- ✅ **Module name**: `quickbooks_api_check` (CONCISE - 22 chars)
- ✅ **Docstrings**: Use FULL objective (for complete documentation)
- ✅ **Logs**: Use FULL objective (for complete context)

---

## Checklist for Code Generation Methods

When implementing or updating code generation methods, ensure:

- [ ] **Receive FULL objective/description** as parameter
- [ ] **Generate CONCISE name** using `generate_concise_name()`
- [ ] **Sanitize concise name** using `sanitize_objective()`
- [ ] **Use concise names for identifiers**: class names, function names, variable names
- [ ] **Use full objective in docstrings**: Module docstrings, class docstrings, function docstrings
- [ ] **Use full objective in comments**: Inline comments explaining implementation
- [ ] **Use full objective in logs**: Error messages, info logs (for debugging)

---

## LLM-Based Code Generation

If using LLM for code generation, ensure the prompt includes:

```python
prompt = f"""
Generate code for: {objective}  ← FULL objective

Requirements:
1. Use concise names for identifiers:
   - Class name: {class_name}  ← CONCISE
   - Function name: {function_name}  ← CONCISE
   - Module name: {module_name}  ← CONCISE

2. Use full objective in documentation:
   - Module docstring: Explain that this implements {objective}  ← FULL
   - Function docstrings: Describe how it handles {objective}  ← FULL
   - Comments: Explain implementation details for {objective}  ← FULL

Generate code following this pattern.
"""
```

---

## Summary

✅ **Agents receive FULL descriptions** → Complete understanding  
✅ **Agents use FULL descriptions in code** → Complete documentation  
✅ **Agents generate CONCISE names for identifiers** → Clean, readable code  

**Result**: Best of both worlds - complete context with clean code!

---

**Last Updated**: November 24, 2025  
**Status**: ✅ Pattern Established and Verified

