"""
Temporal Worker Runner
Generated by WorkflowAgent
"""

import asyncio
import logging
import os
from temporalio.client import Client
from temporalio.worker import Worker

from shared.temporal_defs.workflows.backfill import BackfillWorkflow
from worker.temporal.activities.entities import fetch_qbo_entities, upsert_odoo_entities


logger = logging.getLogger(__name__)

TEMPORAL_ADDRESS = os.getenv("TEMPORAL_ADDRESS", "localhost:7233")
TEMPORAL_NAMESPACE = os.getenv("TEMPORAL_NAMESPACE", "default")
TEMPORAL_TASK_QUEUE = os.getenv("TEMPORAL_TASK_QUEUE", "q2o-sync")


async def main():
    """Main worker function."""
    logger.info(f"Connecting to Temporal at {TEMPORAL_ADDRESS}")
    
    # Connect to Temporal
    client = await Client.connect(
        TEMPORAL_ADDRESS,
        namespace=TEMPORAL_NAMESPACE,
    )
    
    logger.info(f"Starting worker on task queue: {TEMPORAL_TASK_QUEUE}")
    
    # Create worker
    worker = Worker(
        client,
        task_queue=TEMPORAL_TASK_QUEUE,
        workflows=[BackfillWorkflow],
        activities=[fetch_qbo_entities, upsert_odoo_entities],
    )
    
    logger.info("Worker started. Listening for tasks...")
    
    # Run worker
    await worker.run()


if __name__ == "__main__":
    asyncio.run(main())

